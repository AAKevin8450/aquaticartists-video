{
  "modelInput": {
    "messages": [
      {
        "role": "user",
        "content": [
          {
            "video": {
              "format": "mp4",
              "source": {
                "s3Location": {
                  "uri": "s3://video-analysis-app-676206912644/proxies/C0126_33938_720p15.MP4"
                }
              }
            }
          },
          {
            "text": "Analyze this video and return a SINGLE JSON object that includes all five analysis sections.\n\nSUMMARY REQUIREMENTS:\n- 6-10 paragraphs, 600-900 words, include opening context, content structure, detailed topic coverage, visual/audio analysis, critical moments with timestamps, and practical applications.\n- Provide the summary in en language.\n- Incorporate insights from the transcript summary if provided.\n- Include specific examples, product names, technical details, and timestamps.\n\nCHAPTERS REQUIREMENTS:\n- Title (3-8 words): Clear, descriptive chapter title\n- Start/end timecodes (MM:SS or HH:MM:SS)\n- Summary (2-3 sentences): Brief overview of the chapter\n- Detailed_summary (4-8 sentences, 100-200 words): In-depth description including:\n  * Specific actions, demonstrations, or explanations shown\n  * Technical details, measurements, specifications mentioned\n  * Equipment, tools, or products featured with brands/models\n  * Key visual elements and camera work\n  * Important dialogue or narrator insights\n  * Step-by-step techniques or processes\n  * Problems solved or challenges addressed\n- Key_points (3-8 bullets): Specific, actionable takeaways\n- Chapters should be contiguous and cover the full video without gaps when possible.\n\nELEMENTS REQUIREMENTS:\n- Equipment: name, category, time_ranges, discussed (true/false), confidence (high/medium/low).\n- Topics: topic, time_ranges, importance (high/medium/low), description, keywords (3-8 terms).\n- People: max_count, multiple_speakers.\n- Speakers: speaker_id, role, time_ranges, speaking_percentage.\n\nWATERFALL CLASSIFICATION REQUIREMENTS:\n- Follow the sequential 4-step decision process and spec below.\n- Apply Unknown rules and include confidence, evidence, unknown_reasons.\n- Additionally provide \"search_tags\", \"product_keywords\", \"content_type\", \"skill_level\", \"building_techniques\".\n\nSEARCH METADATA REQUIREMENTS (for discovery):\n\nDATE EXTRACTION (CRITICAL - check all sources):\n- File path patterns: YYYYMMDD, YYYY-MM-DD, YYYY_MM_DD, MM-DD-YYYY, MMDDYYYY\n- Example paths: \"2024-03-15_Johnson_Pool\" -> recording_date: \"2024-03-15\"\n- Transcript mentions: \"today is March 15th\", \"recorded on...\", \"this was filmed in June 2023\"\n- Visual cues: on-screen dates, timestamps, calendars visible\n- If multiple dates found, prefer the one closest to the start of the path/filename\n- Output as ISO format YYYY-MM-DD when possible; null if no date evidence\n\nCUSTOMER/PROJECT NAME EXTRACTION (these are synonymous - check all sources):\n- File path: First segment after drive/root is often the customer (e.g., \"E:/videos/Johnson Family/...\" -> \"Johnson Family\")\n- Filename: May contain customer name directly (e.g., \"Smith_Pool_Installation.mp4\" -> \"Smith\")\n- Transcript: \"Mr. Johnson\", \"the Smith residence\", \"working for ABC Pools\", \"this is the Martinez project\"\n- Look for proper nouns, family names, business names in any source\n- Cross-reference across sources for higher confidence (e.g., path says \"Johnson\" and transcript mentions \"Mr. Johnson\")\n\nLOCATION EXTRACTION (multiple sources):\n- File path: city names, state abbreviations, addresses in folder names\n- Transcript: \"here in Phoenix\", \"this property in Scottsdale\", \"Arizona weather\", street addresses\n- Visual: address signs, business names with locations, license plates (state), landmarks\n- Normalize to: city, state_region, country when identifiable\n\nSTANDARD FIELDS:\n- Project: customer_name, project_name, job_number/project_code, project_type.\n- Location: site_name, city, state_region, country, address_fragment.\n- Water feature: family, type_keywords, style_keywords.\n- Content: content_type, skill_level.\n- Entities: list of ALL extracted entities (dates, names, locations, etc.) with sources and evidence.\n- Keywords: 8-20 lowercase search tags.\n\nOUTPUT JSON SCHEMA (return ONLY JSON, no markdown):\n{\n  \"summary\": {\n    \"text\": \"...\",\n    \"depth\": \"detailed\",\n    \"language\": \"en\"\n  },\n  \"chapters\": {\n    \"chapters\": [\n      {\n        \"index\": 1,\n        \"title\": \"...\",\n        \"start_time\": \"00:00\",\n        \"end_time\": \"03:00\",\n        \"summary\": \"Brief 2-3 sentence overview...\",\n        \"detailed_summary\": \"Comprehensive 4-8 sentence description with specific details, technical information, exact procedures, and visual demonstrations shown...\",\n        \"key_points\": [\"Specific point 1\", \"Specific point 2\", \"Specific point 3\"]\n      }\n    ]\n  },\n  \"elements\": {\n    \"equipment\": [\n      {\n        \"name\": \"...\",\n        \"category\": \"...\",\n        \"time_ranges\": [\"MM:SS-MM:SS\"],\n        \"discussed\": true,\n        \"confidence\": \"high\"\n      }\n    ],\n    \"topics_discussed\": [\n      {\n        \"topic\": \"...\",\n        \"time_ranges\": [\"MM:SS-MM:SS\"],\n        \"importance\": \"high\",\n        \"description\": \"...\",\n        \"keywords\": [\"...\"]\n      }\n    ],\n    \"people\": {\n      \"max_count\": 2,\n      \"multiple_speakers\": true\n    },\n    \"speakers\": [\n      {\n        \"speaker_id\": \"Speaker_1\",\n        \"role\": \"...\",\n        \"time_ranges\": [\"MM:SS-MM:SS\"],\n        \"speaking_percentage\": 65\n      }\n    ]\n  },\n  \"waterfall_classification\": {\n    \"family\": \"...\",\n    \"tier_level\": \"...\",\n    \"functional_type\": \"...\",\n    \"sub_type\": \"...\",\n    \"confidence\": {\n      \"family\": 0.0,\n      \"tier_level\": 0.0,\n      \"functional_type\": 0.0,\n      \"sub_type\": 0.0,\n      \"overall\": 0.0\n    },\n    \"evidence\": [\"...\"],\n    \"unknown_reasons\": {},\n    \"search_tags\": [\"...\"],\n    \"product_keywords\": [\"...\"],\n    \"content_type\": \"...\",\n    \"skill_level\": \"...\",\n    \"building_techniques\": [\"...\"]\n  },\n  \"search_metadata\": {\n    \"recording_date\": {\n      \"date\": \"YYYY-MM-DD or null if unknown\",\n      \"date_source\": \"path|filename|transcript|visual|unknown\",\n      \"confidence\": 0.0,\n      \"raw_date_string\": \"original text/pattern found (e.g., '20240315', 'March 15th')\"\n    },\n    \"project\": {\n      \"customer_name\": \"extracted customer/client/project name or null (synonymous with project_name)\",\n      \"project_name\": \"same as customer_name - use identical value\",\n      \"name_source\": \"path|filename|transcript|unknown\",\n      \"name_confidence\": 0.0,\n      \"project_code\": \"any project/job code found or null\",\n      \"job_number\": \"any job number found or null\",\n      \"project_type\": \"...\"\n    },\n    \"location\": {\n      \"site_name\": \"...\",\n      \"city\": \"extracted city name or null\",\n      \"state_region\": \"extracted state/region or null\",\n      \"country\": \"USA if US state detected, else extracted or null\",\n      \"address_fragment\": \"any partial address found\",\n      \"location_source\": \"path|transcript|visual|unknown\",\n      \"location_confidence\": 0.0\n    },\n    \"water_feature\": {\n      \"family\": \"...\",\n      \"type_keywords\": [\"...\"],\n      \"style_keywords\": [\"...\"]\n    },\n    \"content\": {\n      \"content_type\": \"...\",\n      \"skill_level\": \"...\"\n    },\n    \"entities\": [\n      {\n        \"type\": \"...\",\n        \"value\": \"...\",\n        \"normalized\": \"...\",\n        \"sources\": [\"filename\", \"path\", \"transcript_summary\"],\n        \"evidence\": \"...\",\n        \"confidence\": 0.0\n      }\n    ],\n    \"keywords\": [\"...\"]\n  }\n}\n\nDecision Tree:\n# Nova Waterfall Classification \u2014 Decision Tree (AA / Genesis)\n\nThis document defines the **complete decision logic** Nova should use to classify waterfall content in raw video.\n\n## Taxonomy (4 dimensions)\n\n1. **Family**: `Custom Natural Stone` | `Custom Formal` | `Genesis Natural` | `Genesis Formal` | `Unknown`\n2. **Tier Level**: `Classic (Small)` | `Deluxe (Medium)` | `Ultimate (Large)` | `Unknown`\n3. **Functional Type**: `Waterfall` | `Waterfall with Slide` | `Grotto` | `Grotto with Slide` | `Unknown`\n4. **Sub-Type**: `One-Tier` | `Two-Tier` | `Two-Tier Split` | `Three-Tier` | `Cantilever` | `Unknown`\n\n> Output must include all 4 dimensions. If any dimension cannot be determined confidently, output `Unknown` for that dimension and include a reason.\n\n---\n\n## Inputs Nova may use (ranked by reliability)\n\n1. **Visual evidence** (highest): geometry, materials, presence of slide/grotto, number of drops, spill edge shape.\n2. **Spoken narration / on-screen text**: brand and product words (e.g., \u201cGenesis\u201d, \u201ckit\u201d, \u201cformal\u201d, \u201cgrotto\u201d, \u201ccantilever\u201d).\n3. **Context / environment cues**: heavy machinery, build scale, jobsite complexity, site integration.\n\n---\n\n## Decision Order (strict)\n\n1. Determine **Family**\n2. Determine **Functional Type**\n3. Determine **Tier Level**\n4. Determine **Sub-Type**\n\nReason: Family + Functional Type are most visually distinct and least ambiguous; Tier and Sub-Type depend on those.\n\n---\n\n# Step 1 \u2014 Determine Family (4 Types)\n\nNova must choose **one** of these four Families.\n\n## Family Definitions (clarified)\n\n### 1) Genesis Natural (KIT + BOULDERS)\nStandardized \u201ckit\u201d waterfalls made with **natural boulders**. Often compact and repeatable in layout.\n\n### 2) Custom Natural Stone (CUSTOM + BOULDERS)\nBespoke Aquatic Artists features built from **natural boulders** and custom rockwork. Typically more integrated, varied, and often larger/complex.\n\n### 3) Genesis Formal (KIT + NO BOULDERS)\nStandardized \u201cformal\u201d kits: **rectilinear/modern geometry** made with **veneer/caps** and clean spill edges. **No boulders.**\n\n### 4) Custom Formal (CUSTOM + NO BOULDERS)\nLarge bespoke formal features (Aquatic Artists custom) that use **veneer, marble, stone caps, tile/other coverings**, and modern geometry. **No boulders.**\n\n---\n\n## 1A) First split: Boulder vs No Boulder (fastest rule)\n\n**Rule A (Boulder present):**\n- If the feature\u2019s primary construction is **natural boulders** (irregular rounded/angled stones, stacked rockwork that reads as \u201cboulder waterfall\u201d), then Family must be:\n  - `Genesis Natural` **or** `Custom Natural Stone`\n\n**Rule B (No boulders):**\n- If the feature is **not** built from boulders (it\u2019s rectilinear, veneer-faced, slab-capped, tiled, marble/stone faced, etc.), then Family must be:\n  - `Genesis Formal` **or** `Custom Formal`\n\n> IMPORTANT: \u201cSome rock around a formal feature\u201d does not change this. If the **water-producing structure** is formal/veneer/capped (and not a boulder stack), treat it as **Formal**.\n\n---\n\n## 1B) Second split: Genesis (kit) vs Custom (bespoke)\n\nAfter deciding Boulder vs No Boulder, decide whether it\u2019s a **Genesis kit** or a **Custom** build.\n\n### Genesis (kit) indicators (use for both Natural & Formal)\n**Primary kit cues (visual + contextual):**\n- Layout looks **repeatable/staged** (like a \u201cproductized\u201d unit)\n- Compact footprint and relatively simple integration\n- Often appears \u201cfinished on all sides\u201d (rear/side facing is intentionally composed)\n- Install content emphasizes speed/simplicity (often \u201cinstall in a day\u201d)\n- Spoken cues: \u201cGenesis\u201d, \u201ckit\u201d, \u201csingle/double\u201d, \u201ccorner\u201d\n\n**If most kit cues are present \u2192 choose Genesis (Natural or Formal depending on boulder/no boulder).**\n\n### Custom (bespoke) indicators (use for both Natural & Formal)\n**Primary custom cues (visual + contextual):**\n- Highly site-specific geometry and integration (custom curves, multi-zone terraces, unique openings)\n- Larger complexity footprint: deep excavation, large staging, multiple build days visible\n- Heavy equipment (crane, skid steer frequently moving large pieces), large plumbing runs, multiple circuits\n- Spoken cues: \u201ccustom\u201d, \u201cAquatic Artists\u201d, \u201cproject update\u201d, \u201cdesigned for this backyard\u201d, etc.\n\n**If most custom cues are present \u2192 choose Custom (Natural Stone or Formal depending on boulder/no boulder).**\n\n---\n\n## 1C) Family assignment (final rules)\n\n### If BOULDERS are present\n- If **kit cues dominate** \u2192 **Family = Genesis Natural**\n- If **bespoke cues dominate** \u2192 **Family = Custom Natural Stone**\n\n### If NO BOULDERS are present\n- If **kit cues dominate** (standard rectilinear unit, repeatable build, \u201cGenesis\u201d language) \u2192 **Family = Genesis Formal**\n- If **bespoke cues dominate** (large formal statement piece, custom sizes/geometry, premium coverings, heavy integration) \u2192 **Family = Custom Formal**\n\n---\n\n## Family Conflict Resolution (strict)\n\n1. **Boulder present?** If yes \u2192 Natural families only (Genesis Natural / Custom Natural Stone). If no \u2192 Formal families only (Genesis Formal / Custom Formal).\n2. Within Natural/Formal: if explicit \u201cGenesis kit\u201d language or strong kit visuals \u2192 pick the Genesis option.\n3. If the feature is very large/complex and clearly custom-built on site \u2192 pick the Custom option.\n4. If still unclear \u2192 `Unknown` with reason (e.g., \u201cBoulder presence unclear due to close-up shots\u201d or \u201cCannot determine kit vs custom from this segment\u201d).\n\n---\n\n# Step 2 \u2014 Determine Functional Type\n\nFunctional Type is based on **presence of slide and/or grotto cavity**.\n\n## 2A) Detect Slide (binary)\n**Visual identifiers:**\n- Visible slide chute (fiberglass/plastic surface) OR\n- Ladder to slide OR\n- Landscape slide route integrated into rockwork with **stairs/steps** and handholds/railings\n\nIf present: `has_slide = true`\n\n## 2B) Detect Grotto (binary)\n**Visual identifiers:**\n- A **cave/overhang** large enough for people (seating, standing space, shaded cavity)\n- \u201cRoof\u201d spanning an opening (grotto top)\n- Camera shots from inside looking out\n\nIf present: `has_grotto = true`\n\n## 2C) Assign Functional Type\n- if `has_grotto = false` and `has_slide = false` \u2192 **Waterfall**\n- if `has_grotto = false` and `has_slide = true`  \u2192 **Waterfall with Slide**\n- if `has_grotto = true`  and `has_slide = false` \u2192 **Grotto**\n- if `has_grotto = true`  and `has_slide = true`  \u2192 **Grotto with Slide**\n\n**Conflict rule:**\n- If grotto cavity is visible, set `has_grotto = true` even if narration says \u201cwaterfall\u201d.\n\n---\n\n# Step 3 \u2014 Determine Tier Level (Classic / Deluxe / Ultimate)\n\nTier is a **size/complexity** classification. Nova should use a weighted combination of:\n- **Approximate height** of the main waterfall face (relative to pool beam, human body, ladder steps)\n- **Approximate width** of the feature along the pool edge\n- **Largest element size** (boulder size for natural; face/cap scale for formal) vs human scale\n- **Overall footprint** (depth off pool, terracing, multiple areas)\n- **Project complexity** (multiple circuits, extensive plumbing, large equipment)\n\n## 3A) Classic (Small)\nUse `Classic` if most of these are true:\n- Height appears roughly **1.5\u20132 ft**\n- Width appears roughly **8\u201310 ft**\n- Slide version uses a **ladder** (common for smaller slide installs)\n- Minimal terracing; compact composition\n\n## 3B) Deluxe (Medium)\nUse `Deluxe` if most of these are true:\n- Height appears roughly **2.5\u20133 ft**\n- Width appears roughly **12\u201314 ft**\n- Slide version is a **landscape slide** (no ladder) with **steps required**\n- More robust rockwork/structure and footprint than Classic\n\n## 3C) Ultimate (Large)\nUse `Ultimate` if any of these are strongly true:\n- Clearly \u201cbackyard water park\u201d scale\n- Very large footprint or very large elements (boulders or formal wall massing)\n- Heavy machinery and/or massive material volumes\n- Complex multi-feature systems (grotto + slide + multiple cascades, etc.)\n\n**Tier Conflict Resolution:**\n- If strong Ultimate cues exist (massive footprint/complexity), choose **Ultimate** even if width/height are uncertain.\n- If both Classic and Deluxe cues exist, prefer **Deluxe** when there are stairs/landscape slide or clearly larger footprint.\n\n**If uncertain:**\n- Output Tier = `Unknown` with reason: \u201cInsufficient scale reference / no reliable height & width cues.\u201d\n\n---\n\n# Step 4 \u2014 Determine Sub-Type (tiers / split / cantilever)\n\nSub-Type describes **how water is formed and how many distinct drops/cascades exist**.\n\n## 4A) One-Tier\n**Definition:**\n- One primary drop from spill edge directly into pool\n\n**Visual identifiers:**\n- No intermediate shelf where water lands before pool\n- Water originates near the pool edge\n\n## 4B) Two-Tier\n**Definition:**\n- Two distinct drops: water falls to an intermediate shelf/landing, then falls into pool\n\n**Visual identifiers:**\n- A visible middle shelf/step where water breaks before reaching the pool\n- Feature starts farther \u201cback\u201d from the pool edge\n\n## 4C) Two-Tier Split\n**Definition:**\n- A two-tier composition where the flow **splits around a boulder/divider**\n\n**Visual identifiers:**\n- Water divides into two channels (\u201ctwo tongues\u201d) around a central rock\n\n## 4D) Three-Tier\n**Definition:**\n- Three distinct drops (top \u2192 mid shelf \u2192 lower shelf \u2192 pool)\n\n**Visual identifiers:**\n- Two intermediate shelves are visible (water breaks at two separate landings before pool)\n- Feature begins farther back and reads as a small \u201cstream\u201d with three steps\n\n## 4E) Cantilever\n**Definition:**\n- A prominent flat spill stone or straight spill edge projects outward over the pool (a \u201ccantilever\u201d), producing a clean sheet-like drop from its edge\n\n**Visual identifiers:**\n- Obvious projecting ledge/flat stone over waterline OR a distinct straight spill edge\n- Water exits from a crisp edge, often as a more uniform sheet\n\n**Sub-Type Conflict Resolution (strict priority):**\n1. If a clear projecting spill edge is visible \u2192 **Cantilever**\n2. Else if flow clearly splits around a central boulder \u2192 **Two-Tier Split**\n3. Else if three distinct drops exist \u2192 **Three-Tier**\n4. Else if two distinct drops exist \u2192 **Two-Tier**\n5. Else \u2192 **One-Tier**\n\n**If uncertain:**\n- Output Sub-Type = `Unknown` with reason: \u201cWater path not fully visible / camera angle obscures tiers.\u201d\n\n---\n\n# Quick Summary (1-line logic)\n\n1. **Boulders?** Yes \u2192 Natural (Genesis Natural vs Custom Natural Stone). No \u2192 Formal (Genesis Formal vs Custom Formal).\n2. **Kit cues?** Yes \u2192 Genesis. No \u2192 Custom.\n3. **Slide? / Grotto cavity?** Use the 2x2 mapping.\n4. **Tier** by scale/complexity; **Sub-Type** by water path (Cantilever > Split > 3-tier > 2-tier > 1-tier).\n\n\nSpec:\n{\n  \"spec_name\": \"Nova Waterfall Classification Spec\",\n  \"spec_version\": \"1.1.0\",\n  \"created_local_date\": \"2025-12-22\",\n  \"taxonomy\": {\n    \"family\": {\n      \"type\": \"enum\",\n      \"allowed\": [\n        \"Custom Natural Stone\",\n        \"Custom Formal\",\n        \"Genesis Natural\",\n        \"Genesis Formal\",\n        \"Unknown\"\n      ],\n      \"description\": \"4-type family model. Natural families include boulders; Formal families exclude boulders.\"\n    },\n    \"tier_level\": {\n      \"type\": \"enum\",\n      \"allowed\": [\n        \"Classic (Small)\",\n        \"Deluxe (Medium)\",\n        \"Ultimate (Large)\",\n        \"Unknown\"\n      ],\n      \"description\": \"Relative size/complexity tier.\"\n    },\n    \"functional_type\": {\n      \"type\": \"enum\",\n      \"allowed\": [\n        \"Waterfall\",\n        \"Waterfall with Slide\",\n        \"Grotto\",\n        \"Grotto with Slide\",\n        \"Unknown\"\n      ],\n      \"description\": \"Functional configuration: waterfall only, slide, grotto, or both.\"\n    },\n    \"sub_type\": {\n      \"type\": \"enum\",\n      \"allowed\": [\n        \"One-Tier\",\n        \"Two-Tier\",\n        \"Two-Tier Split\",\n        \"Three-Tier\",\n        \"Cantilever\",\n        \"Unknown\"\n      ],\n      \"description\": \"Water path subtype based on tiers (1/2/3), split flow, and cantilevered spill edge.\"\n    }\n  },\n  \"output_format\": {\n    \"unit_of_classification\": \"clip_or_segment\",\n    \"required_fields\": [\n      \"family\",\n      \"tier_level\",\n      \"functional_type\",\n      \"sub_type\",\n      \"confidence\",\n      \"evidence\",\n      \"unknown_reasons\"\n    ],\n    \"fields\": {\n      \"segment_id\": {\n        \"type\": \"string\",\n        \"required\": false,\n        \"description\": \"Optional identifier for the clip/segment.\"\n      },\n      \"time_start_seconds\": {\n        \"type\": \"number\",\n        \"required\": false,\n        \"description\": \"Optional start time (seconds) if segmenting a longer video.\"\n      },\n      \"time_end_seconds\": {\n        \"type\": \"number\",\n        \"required\": false,\n        \"description\": \"Optional end time (seconds) if segmenting a longer video.\"\n      },\n      \"family\": {\n        \"$ref\": \"#/taxonomy/family\"\n      },\n      \"tier_level\": {\n        \"$ref\": \"#/taxonomy/tier_level\"\n      },\n      \"functional_type\": {\n        \"$ref\": \"#/taxonomy/functional_type\"\n      },\n      \"sub_type\": {\n        \"$ref\": \"#/taxonomy/sub_type\"\n      },\n      \"confidence\": {\n        \"type\": \"object\",\n        \"required\": true,\n        \"description\": \"Per-dimension and overall confidence.\",\n        \"properties\": {\n          \"family\": {\n            \"type\": \"number\",\n            \"minimum\": 0.0,\n            \"maximum\": 1.0\n          },\n          \"tier_level\": {\n            \"type\": \"number\",\n            \"minimum\": 0.0,\n            \"maximum\": 1.0\n          },\n          \"functional_type\": {\n            \"type\": \"number\",\n            \"minimum\": 0.0,\n            \"maximum\": 1.0\n          },\n          \"sub_type\": {\n            \"type\": \"number\",\n            \"minimum\": 0.0,\n            \"maximum\": 1.0\n          },\n          \"overall\": {\n            \"type\": \"number\",\n            \"minimum\": 0.0,\n            \"maximum\": 1.0\n          }\n        }\n      },\n      \"evidence\": {\n        \"type\": \"array\",\n        \"required\": true,\n        \"items\": {\n          \"type\": \"string\"\n        },\n        \"description\": \"Short strings describing the cues used (visual and/or narration).\"\n      },\n      \"unknown_reasons\": {\n        \"type\": \"object\",\n        \"required\": true,\n        \"description\": \"Only include non-empty values for dimensions labeled Unknown.\",\n        \"properties\": {\n          \"family\": {\n            \"type\": \"string\"\n          },\n          \"tier_level\": {\n            \"type\": \"string\"\n          },\n          \"functional_type\": {\n            \"type\": \"string\"\n          },\n          \"sub_type\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    }\n  },\n  \"decision_order\": [\n    \"family\",\n    \"functional_type\",\n    \"tier_level\",\n    \"sub_type\"\n  ],\n  \"rules\": {\n    \"family_rules\": {\n      \"primary_visual_rules\": [\n        {\n          \"if_all\": [\n            \"boulders_present\"\n          ],\n          \"then\": {\n            \"family_allowed_subset\": [\n              \"Genesis Natural\",\n              \"Custom Natural Stone\"\n            ]\n          },\n          \"notes\": \"If primary construction uses natural boulders, the family must be Natural.\"\n        },\n        {\n          \"if_all\": [\n            \"boulders_absent\"\n          ],\n          \"then\": {\n            \"family_allowed_subset\": [\n              \"Genesis Formal\",\n              \"Custom Formal\"\n            ]\n          },\n          \"notes\": \"If the water-producing structure is veneer/cap/tile/marble/rectilinear (no boulders), the family must be Formal.\"\n        }\n      ],\n      \"kit_vs_custom_rules\": [\n        {\n          \"if_any\": [\n            \"explicit_genesis_language\",\n            \"kit_like_repeatable_composition\",\n            \"fast_install_emphasis\",\n            \"finished_on_all_sides_productized_unit\"\n          ],\n          \"then\": {\n            \"is_genesis\": true,\n            \"confidence_floor\": 0.75\n          },\n          \"notes\": \"Kit cues indicate Genesis (applies to both Natural and Formal).\"\n        },\n        {\n          \"if_any\": [\n            \"highly_site_specific_integration\",\n            \"heavy_equipment_large_scale\",\n            \"multi_day_build_context\",\n            \"custom_project_language\",\n            \"complex_plumbing_multiple_circuits\"\n          ],\n          \"then\": {\n            \"is_custom\": true,\n            \"confidence_floor\": 0.7\n          },\n          \"notes\": \"Bespoke build cues indicate Custom (applies to both Natural and Formal).\"\n        }\n      ],\n      \"final_assignment\": [\n        {\n          \"if_all\": [\n            \"boulders_present\",\n            \"is_genesis_true\"\n          ],\n          \"then\": {\n            \"family\": \"Genesis Natural\",\n            \"confidence_floor\": 0.8\n          }\n        },\n        {\n          \"if_all\": [\n            \"boulders_present\",\n            \"is_custom_true\"\n          ],\n          \"then\": {\n            \"family\": \"Custom Natural Stone\",\n            \"confidence_floor\": 0.75\n          }\n        },\n        {\n          \"if_all\": [\n            \"boulders_absent\",\n            \"is_genesis_true\"\n          ],\n          \"then\": {\n            \"family\": \"Genesis Formal\",\n            \"confidence_floor\": 0.8\n          }\n        },\n        {\n          \"if_all\": [\n            \"boulders_absent\",\n            \"is_custom_true\"\n          ],\n          \"then\": {\n            \"family\": \"Custom Formal\",\n            \"confidence_floor\": 0.75\n          }\n        }\n      ],\n      \"narration_keywords\": {\n        \"Genesis Natural\": [\n          \"genesis\",\n          \"kit\",\n          \"single\",\n          \"double\",\n          \"corner grotto\",\n          \"360\",\n          \"hidden plumbing\",\n          \"installed in one day\"\n        ],\n        \"Genesis Formal\": [\n          \"genesis\",\n          \"formal\",\n          \"modern\",\n          \"veneer\",\n          \"sheer descent\",\n          \"cap\",\n          \"lighted\",\n          \"spillway\"\n        ],\n        \"Custom Natural Stone\": [\n          \"custom\",\n          \"aquatic artists\",\n          \"project\",\n          \"boulders\",\n          \"natural stone\",\n          \"tons\",\n          \"big boulders\"\n        ],\n        \"Custom Formal\": [\n          \"custom\",\n          \"aquatic artists\",\n          \"formal\",\n          \"veneer\",\n          \"marble\",\n          \"caps\",\n          \"tile\",\n          \"stone facing\"\n        ]\n      },\n      \"conflict_resolution_priority\": [\n        \"BoulderVsNoBoulder\",\n        \"GenesisIfExplicitOrStrongKitCues\",\n        \"CustomIfLargeComplexAndSiteBuilt\",\n        \"UnknownIfStillAmbiguous\"\n      ],\n      \"unknown_policy\": {\n        \"min_confidence_to_assign\": 0.7,\n        \"below_threshold_action\": \"set_family_unknown_with_reason\"\n      }\n    },\n    \"functional_type_rules\": {\n      \"detectors\": {\n        \"has_slide\": {\n          \"visual_cues\": [\n            \"slide_chute_visible\",\n            \"ladder_to_slide\",\n            \"landscape_slide_route\",\n            \"stairs_to_slide\",\n            \"slide_runout_into_pool\"\n          ],\n          \"keyword_cues\": [\n            \"slide\",\n            \"ladder\",\n            \"stairs\",\n            \"steps\"\n          ]\n        },\n        \"has_grotto\": {\n          \"visual_cues\": [\n            \"usable_cavity_or_overhang\",\n            \"grotto_roof_spanning_opening\",\n            \"interior_camera_view\",\n            \"bench_or_sitting_area\"\n          ],\n          \"keyword_cues\": [\n            \"grotto\",\n            \"cave\",\n            \"inside\",\n            \"walk-in\"\n          ]\n        }\n      },\n      \"mapping\": [\n        {\n          \"if\": {\n            \"has_slide\": false,\n            \"has_grotto\": false\n          },\n          \"functional_type\": \"Waterfall\"\n        },\n        {\n          \"if\": {\n            \"has_slide\": true,\n            \"has_grotto\": false\n          },\n          \"functional_type\": \"Waterfall with Slide\"\n        },\n        {\n          \"if\": {\n            \"has_slide\": false,\n            \"has_grotto\": true\n          },\n          \"functional_type\": \"Grotto\"\n        },\n        {\n          \"if\": {\n            \"has_slide\": true,\n            \"has_grotto\": true\n          },\n          \"functional_type\": \"Grotto with Slide\"\n        }\n      ],\n      \"unknown_policy\": {\n        \"min_confidence_to_assign\": 0.75,\n        \"below_threshold_action\": \"set_functional_type_unknown_with_reason\"\n      }\n    },\n    \"tier_level_rules\": {\n      \"signals\": {\n        \"classic\": {\n          \"approx_height_ft_range\": [\n            1.5,\n            2.0\n          ],\n          \"approx_width_ft_range\": [\n            8.0,\n            10.0\n          ],\n          \"slide_access_cue\": \"ladder_common\",\n          \"complexity\": \"low_to_medium\"\n        },\n        \"deluxe\": {\n          \"approx_height_ft_range\": [\n            2.5,\n            3.0\n          ],\n          \"approx_width_ft_range\": [\n            12.0,\n            14.0\n          ],\n          \"slide_access_cue\": \"landscape_slide_steps_required\",\n          \"complexity\": \"medium\"\n        },\n        \"ultimate\": {\n          \"approx_height_ft_range\": [\n            3.0,\n            999.0\n          ],\n          \"approx_width_ft_range\": [\n            14.0,\n            999.0\n          ],\n          \"slide_access_cue\": \"large_landscape_slide\",\n          \"complexity\": \"high\",\n          \"hard_cues\": [\n            \"very_large_boulders_human_scale\",\n            \"heavy_machinery_prominent\",\n            \"multi_feature_water_park_scale\",\n            \"complex_plumbing_multiple_circuits\"\n          ]\n        }\n      },\n      \"assignment_logic\": {\n        \"priority\": [\n          \"Ultimate (Large)\",\n          \"Deluxe (Medium)\",\n          \"Classic (Small)\"\n        ],\n        \"notes\": \"Ultimate can be selected via strong hard cues even if width/height are uncertain.\"\n      },\n      \"unknown_policy\": {\n        \"min_confidence_to_assign\": 0.7,\n        \"below_threshold_action\": \"set_tier_unknown_with_reason\"\n      }\n    },\n    \"sub_type_rules\": {\n      \"detectors\": {\n        \"cantilever_edge\": {\n          \"visual_cues\": [\n            \"projecting_flat_spill_stone_over_pool\",\n            \"distinct_straight_spill_edge\",\n            \"clean_sheet_drop_from_edge\"\n          ],\n          \"keyword_cues\": [\n            \"cantilever\"\n          ]\n        },\n        \"split_flow\": {\n          \"visual_cues\": [\n            \"flow_divides_around_central_boulder\",\n            \"two_distinct_channels_visible\"\n          ],\n          \"keyword_cues\": [\n            \"split\"\n          ]\n        },\n        \"three_tier\": {\n          \"visual_cues\": [\n            \"two_intermediate_shelves_visible\",\n            \"three_distinct_drops_visible\"\n          ],\n          \"keyword_cues\": [\n            \"three-tier\",\n            \"triple cascade\"\n          ]\n        },\n        \"two_tier\": {\n          \"visual_cues\": [\n            \"intermediate_shelf_visible\",\n            \"two_distinct_drops_visible\"\n          ],\n          \"keyword_cues\": [\n            \"two-tier\",\n            \"double cascade\"\n          ]\n        }\n      },\n      \"conflict_resolution_priority\": [\n        \"Cantilever\",\n        \"Two-Tier Split\",\n        \"Three-Tier\",\n        \"Two-Tier\",\n        \"One-Tier\"\n      ],\n      \"assignment_logic\": [\n        {\n          \"if\": \"cantilever_edge\",\n          \"sub_type\": \"Cantilever\"\n        },\n        {\n          \"elif\": \"split_flow\",\n          \"sub_type\": \"Two-Tier Split\"\n        },\n        {\n          \"elif\": \"three_tier\",\n          \"sub_type\": \"Three-Tier\"\n        },\n        {\n          \"elif\": \"two_tier\",\n          \"sub_type\": \"Two-Tier\"\n        },\n        {\n          \"else\": \"One-Tier\"\n        }\n      ],\n      \"unknown_policy\": {\n        \"min_confidence_to_assign\": 0.7,\n        \"below_threshold_action\": \"set_sub_type_unknown_with_reason\"\n      }\n    },\n    \"global_policies\": {\n      \"do_not_guess\": true,\n      \"unknown_allowed_per_dimension\": true,\n      \"confidence_guidelines\": {\n        \"high\": [\n          0.9,\n          1.0\n        ],\n        \"medium\": [\n          0.7,\n          0.89\n        ],\n        \"low\": [\n          0.5,\n          0.69\n        ],\n        \"very_low\": [\n          0.0,\n          0.49\n        ]\n      },\n      \"overall_confidence_calculation\": {\n        \"method\": \"min_of_dimensions\",\n        \"notes\": \"Overall confidence = minimum of the four dimension confidences (conservative).\"\n      }\n    }\n  },\n  \"examples\": [\n    {\n      \"description\": \"Rectilinear veneer waterfall with straight spill edge and sheet-like drop; no boulders; appears custom-sized statement piece\",\n      \"expected\": {\n        \"family\": \"Custom Formal\",\n        \"functional_type\": \"Waterfall\",\n        \"tier_level\": \"Unknown\",\n        \"sub_type\": \"Cantilever\",\n        \"confidence\": {\n          \"family\": 0.8,\n          \"functional_type\": 0.85,\n          \"tier_level\": 0.55,\n          \"sub_type\": 0.8,\n          \"overall\": 0.55\n        },\n        \"evidence\": [\n          \"No boulders; veneer/stone facing\",\n          \"Rectilinear modern geometry\",\n          \"Straight spill edge produces sheet-like drop\"\n        ],\n        \"unknown_reasons\": {\n          \"tier_level\": \"No reliable size reference for height/width.\"\n        }\n      }\n    },\n    {\n      \"description\": \"Natural boulder kit with narration 'Genesis kit', compact footprint, single cascade\",\n      \"expected\": {\n        \"family\": \"Genesis Natural\",\n        \"functional_type\": \"Waterfall\",\n        \"tier_level\": \"Classic (Small)\",\n        \"sub_type\": \"One-Tier\",\n        \"confidence\": {\n          \"family\": 0.85,\n          \"functional_type\": 0.9,\n          \"tier_level\": 0.75,\n          \"sub_type\": 0.8,\n          \"overall\": 0.75\n        },\n        \"evidence\": [\n          \"Boulders clearly visible\",\n          \"Narration indicates Genesis/kit\",\n          \"Compact productized composition\",\n          \"Single drop into pool\"\n        ],\n        \"unknown_reasons\": {}\n      }\n    },\n    {\n      \"description\": \"Large boulder grotto with interior cavity and landscape slide + steps; multi-feature, site-built\",\n      \"expected\": {\n        \"family\": \"Custom Natural Stone\",\n        \"functional_type\": \"Grotto with Slide\",\n        \"tier_level\": \"Ultimate (Large)\",\n        \"sub_type\": \"Two-Tier\",\n        \"confidence\": {\n          \"family\": 0.8,\n          \"functional_type\": 0.95,\n          \"tier_level\": 0.85,\n          \"sub_type\": 0.7,\n          \"overall\": 0.7\n        },\n        \"evidence\": [\n          \"Boulders + custom rockwork\",\n          \"Usable cave/overhang visible\",\n          \"Slide route + steps visible\",\n          \"Large footprint/complexity\"\n        ],\n        \"unknown_reasons\": {}\n      }\n    },\n    {\n      \"description\": \"Formal kit unit with veneer and caps, clean modern face, no boulders, repeatable product-like install\",\n      \"expected\": {\n        \"family\": \"Genesis Formal\",\n        \"functional_type\": \"Waterfall\",\n        \"tier_level\": \"Deluxe (Medium)\",\n        \"sub_type\": \"Cantilever\",\n        \"confidence\": {\n          \"family\": 0.82,\n          \"functional_type\": 0.85,\n          \"tier_level\": 0.7,\n          \"sub_type\": 0.78,\n          \"overall\": 0.7\n        },\n        \"evidence\": [\n          \"No boulders; veneer/capped modern form\",\n          \"Repeatable productized unit cues\",\n          \"Straight spill edge with sheet-like drop\"\n        ],\n        \"unknown_reasons\": {}\n      }\n    }\n  ],\n  \"spec_notes\": [\n    \"Updated Families to 4-type model: Custom Natural Stone, Custom Formal, Genesis Natural, Genesis Formal.\",\n    \"Family decision now uses Boulder vs No Boulder as primary split, then Kit vs Custom.\",\n    \"Added Three-Tier to sub_type allowed values and rules.\"\n  ]\n}\n"
          }
        ]
      }
    ],
    "inferenceConfig": {
      "maxTokens": 4096,
      "temperature": 0.2,
      "topP": 0.9
    }
  },
  "error": {
    "errorCode": 400,
    "errorMessage": "The S3 resource locations in your prompt do not match the folder prefix specified in CreateModelInvocationJob InputDataConfig parameter. Batch Inference requires both JSONL and S3 resources to be in the same S3 bucket and folder (paths are case-sensitive). If you intend to use S3 URIs in prompts, the InputDataConfig parameter must specify a folder containing all linked resources, not an individual .jsonl file.",
    "expired": false,
    "retryable": false
  },
  "recordId": "file-33938:combined"
}